import{g as f,m as L,h as C,o as l,c as s,a as t,t as a,e as M,F as $,d as S,w as E,f as U,n as w,i as j,r as O,j as g,k as B,L as q,p as z}from"./index-f2559fa0.js";import{M as V,_ as F}from"./ProductPagination-aa279be7.js";const A={class:"modal-dialog modal-xl",role:"document"},T={class:"modal-content border-0"},G=t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")],-1),H={class:"modal-body"},J={class:"row"},K={class:"col-md-4"},Q=t("h3",null,"用戶資料",-1),R={class:"table"},W={key:0},X=t("th",{style:{width:"100px"}},"姓名",-1),Y=t("th",null,"Email",-1),Z=t("th",null,"電話",-1),tt=t("th",null,"地址",-1),et={class:"col-md-8"},at=t("h3",null,"訂單細節",-1),lt={class:"table"},st=t("th",{style:{width:"100px"}},"訂單編號",-1),ot=t("th",null,"下單時間",-1),dt=t("th",null,"付款時間",-1),nt={key:0},it={key:1},ct=t("th",null,"付款狀態",-1),rt={key:0,class:"text-success"},ut={key:1,class:"text-muted"},ht=t("th",null,"總金額",-1),mt=t("h3",null,"選購商品",-1),_t={class:"table"},pt=t("thead",null,[t("tr")],-1),bt={class:"text-end"},vt={class:"d-flex justify-content-end"},ft={class:"form-check"},yt={class:"form-check-label",for:"flexCheckDefault"},kt={key:0},$t={key:1},xt={__name:"OrderModal",props:["modalStatus","tempOrder"],emits:["emitModalSataus","emitUpdatePaid"],setup(e,{emit:m}){const n=e,c=f(""),r=f(null),u=f(""),b=y=>new Date(y*1e3).toLocaleDateString(),h=()=>{u.value.hide(),m("emitModalSataus",!1)},p=()=>{m("emitUpdatePaid",c.value),h()};return L(()=>n.modalStatus,()=>{if(n.modalStatus){u.value.show(),c.value=n.tempOrder;return}else{u.value.hide();return}}),C(()=>{u.value=new V(r.value,{})}),(y,k)=>(l(),s("div",{class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modal",ref:r},[t("div",A,[t("div",T,[t("div",{class:"modal-header bg-dark text-white"},[G,t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:h})]),t("div",H,[t("div",J,[t("div",K,[Q,t("table",R,[e.tempOrder.user?(l(),s("tbody",W,[t("tr",null,[X,t("td",null,a(e.tempOrder.user.name),1)]),t("tr",null,[Y,t("td",null,a(e.tempOrder.user.email),1)]),t("tr",null,[Z,t("td",null,a(e.tempOrder.user.tel),1)]),t("tr",null,[tt,t("td",null,a(e.tempOrder.user.address),1)])])):M("",!0)])]),t("div",et,[at,t("table",lt,[t("tbody",null,[t("tr",null,[st,t("td",null,a(e.tempOrder.id),1)]),t("tr",null,[ot,t("td",null,a(b(e.tempOrder.create_at)),1)]),t("tr",null,[dt,t("td",null,[e.tempOrder.paid_date?(l(),s("span",nt,a(b(e.tempOrder.paid_date)),1)):(l(),s("span",it,"尚未付款"))])]),t("tr",null,[ct,t("td",null,[e.tempOrder.is_paid?(l(),s("strong",rt,"已付款")):(l(),s("span",ut,"尚未付款"))])]),t("tr",null,[ht,t("td",null,a(e.tempOrder.total),1)])])]),mt,t("table",_t,[pt,t("tbody",null,[(l(!0),s($,null,S(e.tempOrder.products,_=>(l(),s("tr",{key:_.id},[t("th",null,a(_.product.title),1),t("td",null,a(_.qty)+" / "+a(_.product.unit),1),t("td",bt,a(_.final_total),1)]))),128))])]),t("div",vt,[t("div",ft,[E(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":k[0]||(k[0]=_=>c.value.is_paid=_)},null,512),[[U,c.value.is_paid]]),t("label",yt,[e.tempOrder.is_paid?(l(),s("span",kt,"已付款")):(l(),s("span",$t,"未付款"))])])])])])]),t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:h}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:p}," 修改付款狀態 ")])])])],512))}},gt={class:"modal-dialog",role:"document"},Ot={class:"modal-content border-0"},Mt={class:"modal-header bg-danger text-white"},St={class:"modal-title"},Ct={class:"modal-body"},Dt={class:"text-danger"},wt={class:"modal-footer"},Lt={__name:"DelModal",props:["modalStatus","tempOrder"],emits:["emitModalSataus","emitDelItem"],setup(e,{emit:m}){const n=e,c=f(null),r=f(""),u=()=>{r.value.hide(),m("emitModalSataus",!1)},b=h=>{m("emitDelItem",h)};return L(()=>n.modalStatus,()=>{if(n.modalStatus){r.value.show();return}else{r.value.hide();return}}),C(()=>{r.value=new V(c.value,{})}),(h,p)=>(l(),s("div",{class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modal",ref:c},[t("div",gt,[t("div",Ot,[t("div",Mt,[t("h5",St,[t("span",null,"刪除 "+a(e.tempOrder.title),1)]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:u})]),t("div",Ct,[w(" 是否刪除 "),t("strong",Dt,a(e.tempOrder.title),1),w(" (刪除後將無法恢復)。 ")]),t("div",wt,[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:u}," 取消 "),t("button",{type:"button",class:"btn btn-danger",onClick:p[0]||(p[0]=y=>b(e.tempOrder))},"確認刪除")])])])],512))}},Et={class:"table mt-4"},Ut=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Vt=["textContent"],Pt={class:"list-unstyled"},It={class:"text-right"},Nt={class:"form-check form-switch"},jt=["id","onUpdate:modelValue","onChange"],Bt=["for"],qt={key:0},zt={key:1},Ft={class:"btn-group"},At=["onClick"],Tt=["onClick"],Jt={__name:"DashboardOrders",setup(e){const m=j("axios"),n=f(!1),c="vue-winter",r="https://vue3-course-api.hexschool.io/v2",u=O({data:{}}),b=f(!1),h=f(!1),p=O({data:{}}),y=O({data:{}}),k=d=>{d===!1?b.value=!1:(b.value=!0,p.data={...d})},_=d=>{d===!1?h.value=!1:(h.value=!0,p.data={...d})},x=(d=1)=>{n.value=!0,m.get(`${r}/api/${c}/admin/orders?${d}`).then(i=>{u.data=i.data.orders,y.data=i.data.pagination,n.value=!1}).catch(i=>{alert(i),n.value=!1})},D=d=>{n.value=!0;const i={...d};i.is_paid=d.is_paid,m.put(`${r}/api/${c}/admin/order/${d.id}`,{data:i}).then(()=>{x()}).catch(o=>{alert(o),n.value=!1})},P=d=>{n.value=!0,m.delete(`${r}/api/${c}/admin/order/${d.id}`).then(()=>{n.value=!1,h.value=!1,x()}).catch(i=>{alert(i),n.value=!1})},I=d=>new Date(d*1e3).toLocaleDateString();return C(()=>{const d=document.cookie.replace(/(?:(?:^|.*;\s*)hexschool\s*=\s*([^;]*).*$)|^.*$/,"$1");m.defaults.headers.common.Authorization=d,x()}),(d,i)=>(l(),s($,null,[g(B(q),{active:n.value,"onUpdate:active":i[0]||(i[0]=o=>n.value=o)},null,8,["active"]),t("table",Et,[Ut,t("tbody",null,[(l(!0),s($,null,S(u.data,o=>(l(),s($,{key:o.id},[u.data.length?(l(),s("tr",{key:0,class:z({"text-secondary":!o.is_paid})},[t("td",null,a(I(o.create_at)),1),t("td",null,[o.user?(l(),s("span",{key:0,textContent:a(o.user.email)},null,8,Vt)):M("",!0)]),t("td",null,[t("ul",Pt,[(l(!0),s($,null,S(o.products,(v,N)=>(l(),s("li",{key:N},a(v.product.title)+" 數量："+a(v.qty)+" "+a(v.product.unit),1))),128))])]),t("td",It,a(o.total),1),t("td",null,[t("div",Nt,[E(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${o.id}`,"onUpdate:modelValue":v=>o.is_paid=v,onChange:v=>D(o)},null,40,jt),[[U,o.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${o}`},[o.is_paid?(l(),s("span",qt,"已付款")):(l(),s("span",zt,"未付款"))],8,Bt)])]),t("td",null,[t("div",Ft,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:v=>k(o)}," 檢視 ",8,At),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:v=>_(o)}," 刪除 ",8,Tt)])])],2)):M("",!0)],64))),128))])]),g(F,{pagination:y,onEmitChangePage:x},null,8,["pagination"]),g(xt,{modalStatus:b.value,tempOrder:p.data,onEmitModalSataus:k,onEmitUpdatePaid:D},null,8,["modalStatus","tempOrder"]),g(Lt,{modalStatus:h.value,tempOrder:p.data,onEmitModalSataus:_,onEmitDelItem:P},null,8,["modalStatus","tempOrder"])],64))}};export{Jt as default};
