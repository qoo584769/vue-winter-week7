import{r as g,o as i,c,a as t,w as r,v as m,b as y,F as x,d as L,e as I,f as A,u as R,g as p,i as q,h as G,j as w,k as H,l as J,L as K,t as f}from"./index-f2559fa0.js";import{M as D,_ as O}from"./ProductPagination-aa279be7.js";const Q={class:"modal-dialog modal-xl"},W={class:"modal-content border-0"},X={class:"modal-header bg-dark text-white"},Y={id:"productModalLabel",class:"modal-title"},Z={key:0},tt={key:1},at=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),et={class:"modal-body"},st={class:"row"},ot={class:"col-sm-4"},lt={class:"mb-2"},dt={class:"mb-3"},nt=t("label",{for:"imageUrl",class:"form-label"},"主要圖片網址",-1),it=["src"],ct=t("label",{for:"imageUrl",class:"form-label"},"小圖片網址",-1),rt={key:0},ut={key:1},mt={class:"mb-2"},bt={class:"mb-3"},ht=["onUpdate:modelValue"],pt=["src"],_t={key:0},vt=["onClick"],ft={key:0},gt={class:"col-sm-8"},yt={class:"mb-3"},kt=t("label",{for:"title",class:"form-label"},"標題",-1),$t={class:"row"},Ut={class:"mb-3 col-md-6"},wt=t("label",{for:"category",class:"form-label"},"分類",-1),xt={class:"mb-3 col-md-6"},Mt=t("label",{for:"price",class:"form-label"},"單位",-1),Ct={class:"row"},Vt={class:"mb-3 col-md-6"},Pt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),It={class:"mb-3 col-md-6"},Dt=t("label",{for:"price",class:"form-label"},"售價",-1),Lt=t("hr",null,null,-1),Bt={class:"mb-3"},Nt=t("label",{for:"description",class:"form-label"},"產品描述",-1),St={class:"mb-3"},jt=t("label",{for:"content",class:"form-label"},"說明內容",-1),Et={class:"mb-3"},Ft={class:"form-check"},Tt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),zt={class:"modal-footer"},At=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),Rt={__name:"UandCModal",props:["tempData","addImg","delImg","submitBtn"],setup(u){const a=g(u.tempData);return(h,s)=>(i(),c("div",Q,[t("div",W,[t("div",X,[t("h5",Y,[a.data.status==="create"?(i(),c("span",Z,"新增產品")):(i(),c("span",tt,"編輯產品"))]),at]),t("div",et,[t("div",st,[t("div",ot,[t("div",lt,[t("div",dt,[nt,r(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":s[0]||(s[0]=e=>a.data.imageUrl=e)},null,512),[[m,a.data.imageUrl]])]),t("img",{class:"img-fluid",src:a.data.imageUrl,alt:""},null,8,it)]),ct,!a.data.imagesUrl||a.data.imagesUrl.length===0&&h.addStatus?(i(),c("div",rt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:s[1]||(s[1]=y((...e)=>u.addImg&&u.addImg(...e),["prevent"]))}," 新增圖片 ")])):(i(),c("div",ut,[(i(!0),c(x,null,L(a.data.imagesUrl,(e,b)=>(i(),c("div",{class:"",key:b},[t("div",mt,[t("div",bt,[r(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":l=>a.data.imagesUrl[b]=l},null,8,ht),[[m,a.data.imagesUrl[b]]])]),t("img",{class:"img-fluid",src:e,alt:""},null,8,pt)]),e||e===""?(i(),c("div",_t,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:l=>u.delImg(b)}," 刪除圖片 ",8,vt)])):I("",!0)]))),128)),a.data.imagesUrl[a.data.imagesUrl.length+1]?I("",!0):(i(),c("div",ft,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:s[2]||(s[2]=y((...e)=>u.addImg&&u.addImg(...e),["prevent"]))}," 新增圖片 ")]))]))]),t("div",gt,[t("div",yt,[kt,r(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":s[3]||(s[3]=e=>a.data.title=e)},null,512),[[m,a.data.title]])]),t("div",$t,[t("div",Ut,[wt,r(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":s[4]||(s[4]=e=>a.data.category=e)},null,512),[[m,a.data.category]])]),t("div",xt,[Mt,r(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":s[5]||(s[5]=e=>a.data.unit=e)},null,512),[[m,a.data.unit]])])]),t("div",Ct,[t("div",Vt,[Pt,r(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":s[6]||(s[6]=e=>a.data.origin_price=e)},null,512),[[m,a.data.origin_price]])]),t("div",It,[Dt,r(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":s[7]||(s[7]=e=>a.data.price=e)},null,512),[[m,a.data.price]])])]),Lt,t("div",Bt,[Nt,r(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":s[8]||(s[8]=e=>a.data.description=e)},`
              `,512),[[m,a.data.description]])]),t("div",St,[jt,r(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":s[9]||(s[9]=e=>a.data.content=e)},`
              `,512),[[m,a.data.content]])]),t("div",Et,[t("div",Ft,[r(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":s[10]||(s[10]=e=>a.data.is_enabled=e)},null,512),[[A,a.data.is_enabled]]),Tt])])])])]),t("div",zt,[At,t("button",{type:"button",class:"btn btn-primary",onClick:s[11]||(s[11]=y((...e)=>u.submitBtn&&u.submitBtn(...e),["prevent"]))},"確認")])])]))}},qt={class:"container"},Gt={class:"text-end mt-4"},Ht={class:"table mt-4"},Jt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),Kt={class:"text-end"},Ot={class:"text-end"},Qt={key:0,class:"text-success"},Wt={key:1},Xt={class:"btn-group"},Yt=["onClick"],Zt=["onClick"],ta={class:"modal-dialog"},aa={class:"modal-content border-0"},ea=J('<div class="modal-header bg-danger text-white"><h5 id="delProductModalLabel" class="modal-title"><span>刪除產品</span></h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"> 是否刪除 <strong class="text-danger"></strong> 商品(刪除後將無法恢復)。 </div>',2),sa={class:"modal-footer"},oa=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),la=["onClick"],ia={__name:"DashboardProducts",setup(u){const M=R(),a=p(!1),h="vue-winter",s="https://vue3-course-api.hexschool.io/v2",e=q("axios"),b=g({data:[]}),l=g({data:{}}),k=p(!0),C=p(null),V=p(null),_=p(""),$=p(""),P=g({data:{}}),v=(o=1)=>{a.value=!0,e.get(`${s}/api/${h}/admin/products?page=${o}`).then(n=>{b.data=n.data.products,P.data=n.data.pagination,a.value=!1}).catch(n=>{alert("取得產品列表錯誤",n)})},B=()=>{e.post(`${s}/api/user/check`).then(()=>{v()}).catch(o=>{alert("token驗證錯誤",o),M.push({path:"/login"})})},N=async(o=l.data)=>{a.value=!0;let n="";return await e.post(`${s}/api/${h}/admin/product`,{data:o}).then(d=>{n=d,a.value=!1}).catch(d=>{alert("新增產品錯誤",d),a.value=!1}),n},S=async(o=l.data)=>{a.value=!0;let n="";return await e.put(`${s}/api/${h}/admin/product/${l.data.id}`,{data:o}).then(d=>{n=d,a.value=!1}).catch(d=>{alert("編輯產品錯誤",d),a.value=!1}),n},j=async()=>{a.value=!0,await e.delete(`${s}/api/${h}/admin/product/${l.data.id}`).then(()=>{v(),$.value.hide()}).catch(o=>{alert("刪除產品錯誤",o),a.value=!1})},E=()=>{l.data.imagesUrl?(l.data.imagesUrl.push(""),k.value=!1):(l.data.imagesUrl=[],l.data.imagesUrl.push(""))},F=o=>{l.data.imagesUrl.length!==0?(l.data.imagesUrl.splice(o,1),k.value=!0):(l.data.imagesUrl=void 0,k.value=!0)},T=async()=>{if(a.value=!1,l.data.status==="create")try{(await N()).status===200&&(v(),_.value.hide())}catch(o){alert("新增失敗",o),a.value=!1}else try{(await S()).status===200&&(v(),_.value.hide())}catch(o){alert("編輯失敗",o),a.value=!1}},U=(o,n={})=>{o==="create"?(l.data={},l.data.status=o,_.value.show()):o==="edit"?(l.data=n,l.data.status=o,_.value.show()):o==="del"&&(l.data=n,l.data.status=o,$.value.show())};return G(()=>{_.value=new D(C.value,{}),$.value=new D(V.value,{});const o=document.cookie.replace(/(?:(?:^|.*;\s*)hexschool\s*=\s*([^;]*).*$)|^.*$/,"$1");e.defaults.headers.common.Authorization=o,B()}),(o,n)=>(i(),c(x,null,[w(H(K),{active:a.value,"onUpdate:active":n[0]||(n[0]=d=>a.value=d)},null,8,["active"]),t("div",qt,[t("div",Gt,[t("button",{class:"btn btn-primary",onClick:n[1]||(n[1]=d=>U("create"))},"建立新的產品")]),t("table",Ht,[Jt,t("tbody",null,[(i(!0),c(x,null,L(b.data,d=>(i(),c("tr",{key:d.id},[t("td",null,f(d.category),1),t("td",null,f(d.title),1),t("td",Kt,f(d.origin_price),1),t("td",Ot,f(d.price),1),t("td",null,[d.is_enabled?(i(),c("span",Qt,"啟用")):(i(),c("span",Wt,"未啟用"))]),t("td",null,[t("div",Xt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:z=>U("edit",d)}," 編輯 ",8,Yt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:z=>U("del",d)}," 刪除 ",8,Zt)])])]))),128))])]),w(O,{pagination:P,onEmitChangePage:v},null,8,["pagination"])]),t("div",{id:"productModal",ref_key:"productModal",ref:C,class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},[w(Rt,{"temp-data":l,"add-img":E,"del-img":F,"submit-btn":T},null,8,["temp-data"])],512),t("div",{id:"delProductModal",ref_key:"delProductModal",ref:V,class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},[t("div",ta,[t("div",aa,[ea,t("div",sa,[oa,t("button",{type:"button",class:"btn btn-danger",onClick:y(j,["prevent"])},"確認刪除",8,la)])])])],512)],64))}};export{ia as default};
