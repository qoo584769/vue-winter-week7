import{g as f,m as w,h as M,o as a,c as s,a as t,t as l,e as O,F as $,d as g,w as L,f as E,p as D,i as N,r as C,j as x,k as j,L as B,n as q}from"./index-10e510c1.js";import{M as U}from"./modal-d90a00a2.js";const z={class:"modal-dialog modal-xl",role:"document"},F={class:"modal-content border-0"},A=t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")],-1),T={class:"modal-body"},G={class:"row"},H={class:"col-md-4"},J=t("h3",null,"用戶資料",-1),K={class:"table"},Q={key:0},R=t("th",{style:{width:"100px"}},"姓名",-1),W=t("th",null,"Email",-1),X=t("th",null,"電話",-1),Y=t("th",null,"地址",-1),Z={class:"col-md-8"},tt=t("h3",null,"訂單細節",-1),et={class:"table"},lt=t("th",{style:{width:"100px"}},"訂單編號",-1),at=t("th",null,"下單時間",-1),st=t("th",null,"付款時間",-1),ot={key:0},dt={key:1},nt=t("th",null,"付款狀態",-1),ct={key:0,class:"text-success"},it={key:1,class:"text-muted"},rt=t("th",null,"總金額",-1),ut=t("h3",null,"選購商品",-1),ht={class:"table"},mt=t("thead",null,[t("tr")],-1),_t={class:"text-end"},pt={class:"d-flex justify-content-end"},bt={class:"form-check"},vt={class:"form-check-label",for:"flexCheckDefault"},ft={key:0},yt={key:1},kt={__name:"OrderModal",props:["modalStatus","tempOrder"],emits:["emitModalSataus","emitUpdatePaid"],setup(e,{emit:m}){const n=e,i=f(""),r=f(null),u=f(""),b=y=>new Date(y*1e3).toLocaleDateString(),_=()=>{u.value.hide(),m("emitModalSataus",!1)},p=()=>{m("emitUpdatePaid",i.value),_()};return w(()=>n.modalStatus,()=>{if(n.modalStatus){u.value.show(),i.value=n.tempOrder;return}else{u.value.hide();return}}),M(()=>{u.value=new U(r.value,{})}),(y,k)=>(a(),s("div",{class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modal",ref:r},[t("div",z,[t("div",F,[t("div",{class:"modal-header bg-dark text-white"},[A,t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:_})]),t("div",T,[t("div",G,[t("div",H,[J,t("table",K,[e.tempOrder.user?(a(),s("tbody",Q,[t("tr",null,[R,t("td",null,l(e.tempOrder.user.name),1)]),t("tr",null,[W,t("td",null,l(e.tempOrder.user.email),1)]),t("tr",null,[X,t("td",null,l(e.tempOrder.user.tel),1)]),t("tr",null,[Y,t("td",null,l(e.tempOrder.user.address),1)])])):O("",!0)])]),t("div",Z,[tt,t("table",et,[t("tbody",null,[t("tr",null,[lt,t("td",null,l(e.tempOrder.id),1)]),t("tr",null,[at,t("td",null,l(b(e.tempOrder.create_at)),1)]),t("tr",null,[st,t("td",null,[e.tempOrder.paid_date?(a(),s("span",ot,l(b(e.tempOrder.paid_date)),1)):(a(),s("span",dt,"尚未付款"))])]),t("tr",null,[nt,t("td",null,[e.tempOrder.is_paid?(a(),s("strong",ct,"已付款")):(a(),s("span",it,"尚未付款"))])]),t("tr",null,[rt,t("td",null,l(e.tempOrder.total),1)])])]),ut,t("table",ht,[mt,t("tbody",null,[(a(!0),s($,null,g(e.tempOrder.products,h=>(a(),s("tr",{key:h.id},[t("th",null,l(h.product.title),1),t("td",null,l(h.qty)+" / "+l(h.product.unit),1),t("td",_t,l(h.final_total),1)]))),128))])]),t("div",pt,[t("div",bt,[L(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":k[0]||(k[0]=h=>i.value.is_paid=h)},null,512),[[E,i.value.is_paid]]),t("label",vt,[e.tempOrder.is_paid?(a(),s("span",ft,"已付款")):(a(),s("span",yt,"未付款"))])])])])])]),t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:_}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:p}," 修改付款狀態 ")])])])],512))}},$t={class:"modal-dialog",role:"document"},xt={class:"modal-content border-0"},Ot={class:"modal-header bg-danger text-white"},gt={class:"modal-title"},Mt={class:"modal-body"},St={class:"text-danger"},Dt={class:"modal-footer"},Ct={__name:"DelModal",props:["modalStatus","tempOrder"],emits:["emitModalSataus","emitDelItem"],setup(e,{emit:m}){const n=e,i=f(null),r=f(""),u=()=>{r.value.hide(),m("emitModalSataus",!1)},b=_=>{m("emitDelItem",_)};return w(()=>n.modalStatus,()=>{if(n.modalStatus){r.value.show();return}else{r.value.hide();return}}),M(()=>{r.value=new U(i.value,{})}),(_,p)=>(a(),s("div",{class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modal",ref:i},[t("div",$t,[t("div",xt,[t("div",Ot,[t("h5",gt,[t("span",null,"刪除 "+l(e.tempOrder.title),1)]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:u})]),t("div",Mt,[D(" 是否刪除 "),t("strong",St,l(e.tempOrder.title),1),D(" (刪除後將無法恢復)。 ")]),t("div",Dt,[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:u}," 取消 "),t("button",{type:"button",class:"btn btn-danger",onClick:p[0]||(p[0]=y=>b(e.tempOrder))},"確認刪除")])])])],512))}},wt={class:"table mt-4"},Lt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Et=["textContent"],Ut={class:"list-unstyled"},Vt={class:"text-right"},Pt={class:"form-check form-switch"},It=["id","onUpdate:modelValue","onChange"],Nt=["for"],jt={key:0},Bt={key:1},qt={class:"btn-group"},zt=["onClick"],Ft=["onClick"],Gt={__name:"DashboardOrders",setup(e){const m=N("axios"),n=f(!1),i="vue-winter",r="https://vue3-course-api.hexschool.io/v2",u=C({data:{}}),b=f(!1),_=f(!1),p=C({data:{}}),y=d=>{d===!1?b.value=!1:(b.value=!0,p.data={...d})},k=d=>{d===!1?_.value=!1:(_.value=!0,p.data={...d})},h=(d=1)=>{n.value=!0,m.get(`${r}/api/${i}/admin/orders?${d}`).then(c=>{u.data=c.data.orders,n.value=!1}).catch(c=>{alert(c),n.value=!1})},S=d=>{n.value=!0;const c={...d};c.is_paid=d.is_paid,m.put(`${r}/api/${i}/admin/order/${d.id}`,{data:c}).then(()=>{h()}).catch(o=>{alert(o),n.value=!1})},V=d=>{n.value=!0,m.delete(`${r}/api/${i}/admin/order/${d.id}`).then(()=>{n.value=!1,h()}).catch(c=>{alert(c),n.value=!1})},P=d=>new Date(d*1e3).toLocaleDateString();return M(()=>{const d=document.cookie.replace(/(?:(?:^|.*;\s*)hexschool\s*=\s*([^;]*).*$)|^.*$/,"$1");m.defaults.headers.common.Authorization=d,h()}),(d,c)=>(a(),s($,null,[x(j(B),{active:n.value,"onUpdate:active":c[0]||(c[0]=o=>n.value=o)},null,8,["active"]),t("table",wt,[Lt,t("tbody",null,[(a(!0),s($,null,g(u.data,o=>(a(),s($,{key:o.id},[u.data.length?(a(),s("tr",{key:0,class:q({"text-secondary":!o.is_paid})},[t("td",null,l(P(o.create_at)),1),t("td",null,[o.user?(a(),s("span",{key:0,textContent:l(o.user.email)},null,8,Et)):O("",!0)]),t("td",null,[t("ul",Ut,[(a(!0),s($,null,g(o.products,(v,I)=>(a(),s("li",{key:I},l(v.product.title)+" 數量："+l(v.qty)+" "+l(v.product.unit),1))),128))])]),t("td",Vt,l(o.total),1),t("td",null,[t("div",Pt,[L(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${o.id}`,"onUpdate:modelValue":v=>o.is_paid=v,onChange:v=>S(o)},null,40,It),[[E,o.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${o}`},[o.is_paid?(a(),s("span",jt,"已付款")):(a(),s("span",Bt,"未付款"))],8,Nt)])]),t("td",null,[t("div",qt,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:v=>y(o)}," 檢視 ",8,zt),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:v=>k(o)}," 刪除 ",8,Ft)])])],2)):O("",!0)],64))),128))])]),x(kt,{modalStatus:b.value,tempOrder:p.data,onEmitModalSataus:y,onEmitUpdatePaid:S},null,8,["modalStatus","tempOrder"]),x(Ct,{modalStatus:_.value,tempOrder:p.data,onEmitModalSataus:k,onEmitDelItem:V},null,8,["modalStatus","tempOrder"])],64))}};export{Gt as default};
