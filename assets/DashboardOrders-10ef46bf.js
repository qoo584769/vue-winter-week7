import{r as $,g as y,l as D,h as x,o as s,c as a,a as t,t as l,e as O,F as k,d as g,w as C,f as w,m as M,i as j,j as S,n as B}from"./index-71b40c1c.js";import{M as V}from"./modal-57abecfe.js";const U={class:"modal-dialog modal-xl",role:"document"},q={class:"modal-content border-0"},z=t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")],-1),F={class:"modal-body"},A={class:"row"},P={class:"col-md-4"},T=t("h3",null,"用戶資料",-1),G={class:"table"},H={key:0},J=t("th",{style:{width:"100px"}},"姓名",-1),K=t("th",null,"Email",-1),Q=t("th",null,"電話",-1),R=t("th",null,"地址",-1),W={class:"col-md-8"},X=t("h3",null,"訂單細節",-1),Y={class:"table"},Z=t("th",{style:{width:"100px"}},"訂單編號",-1),tt=t("th",null,"下單時間",-1),et=t("th",null,"付款時間",-1),lt={key:0},st={key:1},at=t("th",null,"付款狀態",-1),ot={key:0,class:"text-success"},dt={key:1,class:"text-muted"},nt=t("th",null,"總金額",-1),ct=t("h3",null,"選購商品",-1),rt={class:"table"},it=t("thead",null,[t("tr")],-1),ut={class:"text-end"},ht={class:"d-flex justify-content-end"},mt={class:"form-check"},_t={class:"form-check-label",for:"flexCheckDefault"},bt={key:0},pt={key:1},ft={class:"modal-footer"},vt={__name:"OrderModal",props:["modalStatus","tempOrder"],emits:["emitModalSataus"],setup(e,{emit:m}){const i=e,p=$({...i.tempOrder}),c=y(null),u=y(""),f=_=>new Date(_*1e3).toLocaleDateString(),h=()=>{u.value.hide(),m("emitModalSataus",!1)};return D(()=>i.modalStatus,()=>{if(i.modalStatus){u.value.show(),console.log(i.tempOrder),console.log(p);return}else{u.value.hide();return}}),x(()=>{u.value=new V(c.value,{})}),(_,b)=>(s(),a("div",{class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modal",ref:c},[t("div",U,[t("div",q,[t("div",{class:"modal-header bg-dark text-white"},[z,t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:h})]),t("div",F,[t("div",A,[t("div",P,[T,t("table",G,[e.tempOrder.user?(s(),a("tbody",H,[t("tr",null,[J,t("td",null,l(e.tempOrder.user.name),1)]),t("tr",null,[K,t("td",null,l(e.tempOrder.user.email),1)]),t("tr",null,[Q,t("td",null,l(e.tempOrder.user.tel),1)]),t("tr",null,[R,t("td",null,l(e.tempOrder.user.address),1)])])):O("",!0)])]),t("div",W,[X,t("table",Y,[t("tbody",null,[t("tr",null,[Z,t("td",null,l(e.tempOrder.id),1)]),t("tr",null,[tt,t("td",null,l(f(e.tempOrder.create_at)),1)]),t("tr",null,[et,t("td",null,[e.tempOrder.paid_date?(s(),a("span",lt,l(f(e.tempOrder.paid_date)),1)):(s(),a("span",st,"尚未付款"))])]),t("tr",null,[at,t("td",null,[e.tempOrder.is_paid?(s(),a("strong",ot,"已付款")):(s(),a("span",dt,"尚未付款"))])]),t("tr",null,[nt,t("td",null,l(e.tempOrder.total),1)])])]),ct,t("table",rt,[it,t("tbody",null,[(s(!0),a(k,null,g(e.tempOrder.products,r=>(s(),a("tr",{key:r.id},[t("th",null,l(r.product.title),1),t("td",null,l(r.qty)+" / "+l(r.product.unit),1),t("td",ut,l(r.final_total),1)]))),128))])]),t("div",ht,[t("div",mt,[C(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":b[0]||(b[0]=r=>e.tempOrder.is_paid=r)},null,512),[[w,e.tempOrder.is_paid]]),t("label",_t,[e.tempOrder.is_paid?(s(),a("span",bt,"已付款")):(s(),a("span",pt,"未付款"))])])])])])]),t("div",ft,[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:h}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:b[1]||(b[1]=r=>_.$emit("update-paid",e.tempOrder))}," 修改付款狀態 ")])])])],512))}},yt={class:"modal-dialog",role:"document"},kt={class:"modal-content border-0"},$t={class:"modal-header bg-danger text-white"},Ot={class:"modal-title"},gt={class:"modal-body"},xt={class:"text-danger"},Mt={class:"modal-footer"},St={__name:"DelModal",props:["modalStatus","tempOrder"],emits:["emitModalSataus","emitDelItem"],setup(e,{emit:m}){const i=e,p=y(null),c=y(""),u=()=>{c.value.hide(),m("emitModalSataus",!1)},f=h=>{m("emitDelItem",h)};return D(()=>i.modalStatus,()=>{if(i.modalStatus){c.value.show();return}else{c.value.hide();return}}),x(()=>{c.value=new V(p.value,{})}),(h,_)=>(s(),a("div",{class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modal",ref:p},[t("div",yt,[t("div",kt,[t("div",$t,[t("h5",Ot,[t("span",null,"刪除 "+l(e.tempOrder.title),1)]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:u})]),t("div",gt,[M(" 是否刪除 "),t("strong",xt,l(e.tempOrder.title),1),M(" (刪除後將無法恢復)。 ")]),t("div",Mt,[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:u}," 取消 "),t("button",{type:"button",class:"btn btn-danger",onClick:_[0]||(_[0]=b=>f(e.tempOrder))},"確認刪除")])])])],512))}},Dt={class:"table mt-4"},Ct=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),wt=["textContent"],Vt={class:"list-unstyled"},Et={class:"text-right"},Lt={class:"form-check form-switch"},It=["id","onUpdate:modelValue","onChange"],Nt=["for"],jt={key:0},Bt={key:1},Ut={class:"btn-group"},qt=["onClick"],zt=["onClick"],Pt={__name:"DashboardOrders",setup(e){const m=j("axios"),i="vue-winter",p="https://vue3-course-api.hexschool.io/v2",c=$({data:{}}),u=y(!1),f=y(!1),h=$({data:{}}),_=o=>{o===!1?u.value=!1:(u.value=!0,h.data={...o})},b=o=>{o===!1?f.value=!1:(f.value=!0,h.data={...o})},r=(o=1)=>{m.get(`${p}/api/${i}/admin/orders?${o}`).then(n=>{console.log(n),c.data=n.data.orders,console.log(c.data)}).catch(n=>{console.log(n)})},E=o=>{const n={...o};n.is_paid=o.is_paid,m.put(`${p}/api/${i}/admin/order/${o.id}`,{data:n}).then(()=>{r()}).catch(d=>{alert(d)})},L=o=>{console.log(o),m.delete(`${p}/api/${i}/admin/order/${o.id}`).then(n=>{console.log(n),r()}).catch(n=>{console.log(n)})},I=o=>new Date(o*1e3).toLocaleDateString();return x(()=>{const o=document.cookie.replace(/(?:(?:^|.*;\s*)hexschool\s*=\s*([^;]*).*$)|^.*$/,"$1");m.defaults.headers.common.Authorization=o,r()}),(o,n)=>(s(),a(k,null,[t("table",Dt,[Ct,t("tbody",null,[(s(!0),a(k,null,g(c.data,d=>(s(),a(k,{key:d.id},[c.data.length?(s(),a("tr",{key:0,class:B({"text-secondary":!d.is_paid})},[t("td",null,l(I(d.create_at)),1),t("td",null,[d.user?(s(),a("span",{key:0,textContent:l(d.user.email)},null,8,wt)):O("",!0)]),t("td",null,[t("ul",Vt,[(s(!0),a(k,null,g(d.products,(v,N)=>(s(),a("li",{key:N},l(v.product.title)+" 數量："+l(v.qty)+" "+l(v.product.unit),1))),128))])]),t("td",Et,l(d.total),1),t("td",null,[t("div",Lt,[C(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${d.id}`,"onUpdate:modelValue":v=>d.is_paid=v,onChange:v=>E(d)},null,40,It),[[w,d.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${d}`},[d.is_paid?(s(),a("span",jt,"已付款")):(s(),a("span",Bt,"未付款"))],8,Nt)])]),t("td",null,[t("div",Ut,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:v=>_(d)}," 檢視 ",8,qt),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:v=>b(d)}," 刪除 ",8,zt)])])],2)):O("",!0)],64))),128))])]),S(vt,{modalStatus:u.value,tempOrder:h.data,onEmitModalSataus:_},null,8,["modalStatus","tempOrder"]),S(St,{modalStatus:f.value,tempOrder:h.data,onEmitModalSataus:b,onEmitDelItem:L},null,8,["modalStatus","tempOrder"])],64))}};export{Pt as default};
