import{r as f,o as i,c,a as t,w as u,v as b,b as y,F as k,d as P,e as L,f as R,n as C,t as g,u as q,g as _,i as G,h as H,j as M,k as J,l as K,L as O}from"./index-2f959b6b.js";import{M as B}from"./modal-9566e273.js";const Q={class:"modal-dialog modal-xl"},W={class:"modal-content border-0"},X={class:"modal-header bg-dark text-white"},Y={id:"productModalLabel",class:"modal-title"},Z={key:0},tt={key:1},at=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),et={class:"modal-body"},st={class:"row"},ot={class:"col-sm-4"},lt={class:"mb-2"},dt={class:"mb-3"},nt=t("label",{for:"imageUrl",class:"form-label"},"主要圖片網址",-1),it=["src"],ct=t("label",{for:"imageUrl",class:"form-label"},"小圖片網址",-1),rt={key:0},ut={key:1},mt={class:"mb-2"},bt={class:"mb-3"},pt=["onUpdate:modelValue"],_t=["src"],ht={key:0},vt=["onClick"],gt={key:0},ft={class:"col-sm-8"},yt={class:"mb-3"},kt=t("label",{for:"title",class:"form-label"},"標題",-1),$t={class:"row"},Ut={class:"mb-3 col-md-6"},xt=t("label",{for:"category",class:"form-label"},"分類",-1),wt={class:"mb-3 col-md-6"},Ct=t("label",{for:"price",class:"form-label"},"單位",-1),Mt={class:"row"},Pt={class:"mb-3 col-md-6"},Vt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),It={class:"mb-3 col-md-6"},Dt=t("label",{for:"price",class:"form-label"},"售價",-1),Lt=t("hr",null,null,-1),Bt={class:"mb-3"},Nt=t("label",{for:"description",class:"form-label"},"產品描述",-1),St={class:"mb-3"},jt=t("label",{for:"content",class:"form-label"},"說明內容",-1),zt={class:"mb-3"},Ft={class:"form-check"},Tt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),At={class:"modal-footer"},Et=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),Rt={__name:"UandCModal",props:["tempData","addImg","delImg","submitBtn"],setup(r){const a=f(r.tempData);return(p,s)=>(i(),c("div",Q,[t("div",W,[t("div",X,[t("h5",Y,[a.data.status==="create"?(i(),c("span",Z,"新增產品")):(i(),c("span",tt,"編輯產品"))]),at]),t("div",et,[t("div",st,[t("div",ot,[t("div",lt,[t("div",dt,[nt,u(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":s[0]||(s[0]=e=>a.data.imageUrl=e)},null,512),[[b,a.data.imageUrl]])]),t("img",{class:"img-fluid",src:a.data.imageUrl,alt:""},null,8,it)]),ct,!a.data.imagesUrl||a.data.imagesUrl.length===0&&p.addStatus?(i(),c("div",rt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:s[1]||(s[1]=y((...e)=>r.addImg&&r.addImg(...e),["prevent"]))}," 新增圖片 ")])):(i(),c("div",ut,[(i(!0),c(k,null,P(a.data.imagesUrl,(e,m)=>(i(),c("div",{class:"",key:m},[t("div",mt,[t("div",bt,[u(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":l=>a.data.imagesUrl[m]=l},null,8,pt),[[b,a.data.imagesUrl[m]]])]),t("img",{class:"img-fluid",src:e,alt:""},null,8,_t)]),e||e===""?(i(),c("div",ht,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:l=>r.delImg(m)}," 刪除圖片 ",8,vt)])):L("",!0)]))),128)),a.data.imagesUrl[a.data.imagesUrl.length+1]?L("",!0):(i(),c("div",gt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:s[2]||(s[2]=y((...e)=>r.addImg&&r.addImg(...e),["prevent"]))}," 新增圖片 ")]))]))]),t("div",ft,[t("div",yt,[kt,u(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":s[3]||(s[3]=e=>a.data.title=e)},null,512),[[b,a.data.title]])]),t("div",$t,[t("div",Ut,[xt,u(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":s[4]||(s[4]=e=>a.data.category=e)},null,512),[[b,a.data.category]])]),t("div",wt,[Ct,u(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":s[5]||(s[5]=e=>a.data.unit=e)},null,512),[[b,a.data.unit]])])]),t("div",Mt,[t("div",Pt,[Vt,u(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":s[6]||(s[6]=e=>a.data.origin_price=e)},null,512),[[b,a.data.origin_price]])]),t("div",It,[Dt,u(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":s[7]||(s[7]=e=>a.data.price=e)},null,512),[[b,a.data.price]])])]),Lt,t("div",Bt,[Nt,u(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":s[8]||(s[8]=e=>a.data.description=e)},`
              `,512),[[b,a.data.description]])]),t("div",St,[jt,u(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":s[9]||(s[9]=e=>a.data.content=e)},`
              `,512),[[b,a.data.content]])]),t("div",zt,[t("div",Ft,[u(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":s[10]||(s[10]=e=>a.data.is_enabled=e)},null,512),[[R,a.data.is_enabled]]),Tt])])])])]),t("div",At,[Et,t("button",{type:"button",class:"btn btn-primary",onClick:s[11]||(s[11]=y((...e)=>r.submitBtn&&r.submitBtn(...e),["prevent"]))},"確認")])])]))}},qt={"aria-label":"Page navigation example"},Gt={class:"pagination"},Ht=t("span",{"aria-hidden":"true"},"«",-1),Jt=[Ht],Kt=["onClick"],Ot=t("span",{"aria-hidden":"true"},"»",-1),Qt=[Ot],Wt={__name:"ProductPagination",props:["pagination","getProducts"],setup(r){const a=f(r.pagination);return(p,s)=>(i(),c("nav",qt,[t("ul",Gt,[t("li",{class:C(["page-item",{disabled:!a.data.has_pre}])},[t("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:s[0]||(s[0]=e=>r.getProducts(a.data.current_page-1))},Jt)],2),(i(!0),c(k,null,P(a.data.total_pages,(e,m)=>(i(),c("li",{key:m,class:C(["page-item",{active:e===a.data.current_page}])},[t("a",{class:"page-link",href:"#",onClick:l=>r.getProducts(e)},g(e),9,Kt)],2))),128)),t("li",{class:C(["page-item",{disabled:!a.data.has_next}])},[t("a",{class:"page-link",href:"#","aria-label":"Next",onClick:s[1]||(s[1]=e=>r.getProducts(a.data.current_page+1))},Qt)],2)])]))}},Xt={class:"container"},Yt={class:"text-end mt-4"},Zt={class:"table mt-4"},ta=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),aa={class:"text-end"},ea={class:"text-end"},sa={key:0,class:"text-success"},oa={key:1},la={class:"btn-group"},da=["onClick"],na=["onClick"],ia={class:"modal-dialog"},ca={class:"modal-content border-0"},ra=K('<div class="modal-header bg-danger text-white"><h5 id="delProductModalLabel" class="modal-title"><span>刪除產品</span></h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"> 是否刪除 <strong class="text-danger"></strong> 商品(刪除後將無法恢復)。 </div>',2),ua={class:"modal-footer"},ma=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),ba=["onClick"],ha={__name:"DashboardProducts",setup(r){const $=q(),a=_(!1),p="vue-winter",s="https://vue3-course-api.hexschool.io/v2",e=G("axios"),m=f({data:[]}),l=f({data:{}}),U=_(!0),V=_(null),I=_(null),h=_(""),x=_(""),D=f({data:{}}),v=(o=1)=>{a.value=!0,e.get(`${s}/api/${p}/admin/products?page=${o}`).then(n=>{m.data=n.data.products,D.data=n.data.pagination,a.value=!1}).catch(n=>{alert("取得產品列表錯誤",n)})},N=()=>{e.post(`${s}/api/user/check`).then(()=>{v()}).catch(o=>{alert("token驗證錯誤",o),$.push({path:"/login"})})},S=async(o=l.data)=>{a.value=!0;let n="";return await e.post(`${s}/api/${p}/admin/product`,{data:o}).then(d=>{n=d,a.value=!1}).catch(d=>{alert("新增產品錯誤",d),a.value=!1}),n},j=async(o=l.data)=>{a.value=!0;let n="";return await e.put(`${s}/api/${p}/admin/product/${l.data.id}`,{data:o}).then(d=>{n=d,a.value=!1}).catch(d=>{alert("編輯產品錯誤",d),a.value=!1}),n},z=async()=>{a.value=!0,await e.delete(`${s}/api/${p}/admin/product/${l.data.id}`).then(()=>{v(),x.value.hide()}).catch(o=>{alert("刪除產品錯誤",o),a.value=!1})},F=()=>{l.data.imagesUrl?(l.data.imagesUrl.push(""),U.value=!1):(l.data.imagesUrl=[],l.data.imagesUrl.push(""))},T=o=>{l.data.imagesUrl.length!==0?(l.data.imagesUrl.splice(o,1),U.value=!0):(l.data.imagesUrl=void 0,U.value=!0)},A=async()=>{if(a.value=!1,l.data.status==="create")try{(await S()).status===200&&(v(),h.value.hide())}catch(o){alert("新增失敗",o),a.value=!1}else try{(await j()).status===200&&(v(),h.value.hide())}catch(o){alert("編輯失敗",o),a.value=!1}},w=(o,n={})=>{o==="create"?(l.data={},l.data.status=o,h.value.show()):o==="edit"?(l.data=n,l.data.status=o,h.value.show()):o==="del"&&(l.data=n,l.data.status=o,x.value.show())};return H(()=>{h.value=new B(V.value,{}),x.value=new B(I.value,{});const o=document.cookie.replace(/(?:(?:^|.*;\s*)hexschool\s*=\s*([^;]*).*$)|^.*$/,"$1");e.defaults.headers.common.Authorization=o,N()}),(o,n)=>(i(),c(k,null,[M(J(O),{active:a.value,"onUpdate:active":n[0]||(n[0]=d=>a.value=d)},null,8,["active"]),t("div",Xt,[t("div",Yt,[t("button",{class:"btn btn-primary",onClick:n[1]||(n[1]=d=>w("create"))},"建立新的產品")]),t("table",Zt,[ta,t("tbody",null,[(i(!0),c(k,null,P(m.data,d=>(i(),c("tr",{key:d.id},[t("td",null,g(d.category),1),t("td",null,g(d.title),1),t("td",aa,g(d.origin_price),1),t("td",ea,g(d.price),1),t("td",null,[d.is_enabled?(i(),c("span",sa,"啟用")):(i(),c("span",oa,"未啟用"))]),t("td",null,[t("div",la,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:E=>w("edit",d)}," 編輯 ",8,da),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:E=>w("del",d)}," 刪除 ",8,na)])])]))),128))])]),M(Wt,{pagination:D,"get-products":v},null,8,["pagination"])]),t("div",{id:"productModal",ref_key:"productModal",ref:V,class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},[M(Rt,{"temp-data":l,"add-img":F,"del-img":T,"submit-btn":A},null,8,["temp-data"])],512),t("div",{id:"delProductModal",ref_key:"delProductModal",ref:I,class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},[t("div",ia,[t("div",ca,[ra,t("div",ua,[ma,t("button",{type:"button",class:"btn btn-danger",onClick:y(z,["prevent"])},"確認刪除",8,ba)])])])],512)],64))}};export{ha as default};
