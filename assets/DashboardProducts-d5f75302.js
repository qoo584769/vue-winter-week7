import{r as f,o as n,c as i,a as t,w as u,v as m,b as y,F as k,d as C,e as I,f as E,n as w,t as v,u as R,i as q,g,h as G,j as D,k as H}from"./index-71b40c1c.js";import{M as B}from"./modal-57abecfe.js";const J={class:"modal-dialog modal-xl"},K={class:"modal-content border-0"},O={class:"modal-header bg-dark text-white"},Q={id:"productModalLabel",class:"modal-title"},W={key:0},X={key:1},Y=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Z={class:"modal-body"},tt={class:"row"},at={class:"col-sm-4"},et={class:"mb-2"},st={class:"mb-3"},ot=t("label",{for:"imageUrl",class:"form-label"},"主要圖片網址",-1),lt=["src"],dt=t("label",{for:"imageUrl",class:"form-label"},"小圖片網址",-1),nt={key:0},it={key:1},ct={class:"mb-2"},rt={class:"mb-3"},ut=["onUpdate:modelValue"],mt=["src"],bt={key:0},pt=["onClick"],_t={key:0},ht={class:"col-sm-8"},gt={class:"mb-3"},vt=t("label",{for:"title",class:"form-label"},"標題",-1),ft={class:"row"},yt={class:"mb-3 col-md-6"},kt=t("label",{for:"category",class:"form-label"},"分類",-1),$t={class:"mb-3 col-md-6"},Ut=t("label",{for:"price",class:"form-label"},"單位",-1),xt={class:"row"},wt={class:"mb-3 col-md-6"},Ct=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Mt={class:"mb-3 col-md-6"},Pt=t("label",{for:"price",class:"form-label"},"售價",-1),Vt=t("hr",null,null,-1),It={class:"mb-3"},Dt=t("label",{for:"description",class:"form-label"},"產品描述",-1),Bt={class:"mb-3"},Lt=t("label",{for:"content",class:"form-label"},"說明內容",-1),Nt={class:"mb-3"},St={class:"form-check"},jt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),zt={class:"modal-footer"},Ft=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),Tt={__name:"UandCModal",props:["tempData","addImg","delImg","submitBtn"],setup(r){const a=f(r.tempData);return(b,e)=>(n(),i("div",J,[t("div",K,[t("div",O,[t("h5",Q,[a.data.status==="create"?(n(),i("span",W,"新增產品")):(n(),i("span",X,"編輯產品"))]),Y]),t("div",Z,[t("div",tt,[t("div",at,[t("div",et,[t("div",st,[ot,u(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=s=>a.data.imageUrl=s)},null,512),[[m,a.data.imageUrl]])]),t("img",{class:"img-fluid",src:a.data.imageUrl,alt:""},null,8,lt)]),dt,!a.data.imagesUrl||a.data.imagesUrl.length===0&&b.addStatus?(n(),i("div",nt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[1]||(e[1]=y((...s)=>r.addImg&&r.addImg(...s),["prevent"]))}," 新增圖片 ")])):(n(),i("div",it,[(n(!0),i(k,null,C(a.data.imagesUrl,(s,l)=>(n(),i("div",{class:"",key:l},[t("div",ct,[t("div",rt,[u(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":p=>a.data.imagesUrl[l]=p},null,8,ut),[[m,a.data.imagesUrl[l]]])]),t("img",{class:"img-fluid",src:s,alt:""},null,8,mt)]),s||s===""?(n(),i("div",bt,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:p=>r.delImg(l)}," 刪除圖片 ",8,pt)])):I("",!0)]))),128)),a.data.imagesUrl[a.data.imagesUrl.length+1]?I("",!0):(n(),i("div",_t,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=y((...s)=>r.addImg&&r.addImg(...s),["prevent"]))}," 新增圖片 ")]))]))]),t("div",ht,[t("div",gt,[vt,u(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[3]||(e[3]=s=>a.data.title=s)},null,512),[[m,a.data.title]])]),t("div",ft,[t("div",yt,[kt,u(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[4]||(e[4]=s=>a.data.category=s)},null,512),[[m,a.data.category]])]),t("div",$t,[Ut,u(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[5]||(e[5]=s=>a.data.unit=s)},null,512),[[m,a.data.unit]])])]),t("div",xt,[t("div",wt,[Ct,u(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[6]||(e[6]=s=>a.data.origin_price=s)},null,512),[[m,a.data.origin_price]])]),t("div",Mt,[Pt,u(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[7]||(e[7]=s=>a.data.price=s)},null,512),[[m,a.data.price]])])]),Vt,t("div",It,[Dt,u(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[8]||(e[8]=s=>a.data.description=s)},`
              `,512),[[m,a.data.description]])]),t("div",Bt,[Lt,u(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[9]||(e[9]=s=>a.data.content=s)},`
              `,512),[[m,a.data.content]])]),t("div",Nt,[t("div",St,[u(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[10]||(e[10]=s=>a.data.is_enabled=s)},null,512),[[E,a.data.is_enabled]]),jt])])])])]),t("div",zt,[Ft,t("button",{type:"button",class:"btn btn-primary",onClick:e[11]||(e[11]=y((...s)=>r.submitBtn&&r.submitBtn(...s),["prevent"]))},"確認")])])]))}},At={"aria-label":"Page navigation example"},Et={class:"pagination"},Rt=t("span",{"aria-hidden":"true"},"«",-1),qt=[Rt],Gt=["onClick"],Ht=t("span",{"aria-hidden":"true"},"»",-1),Jt=[Ht],Kt={__name:"ProductPagination",props:["pagination","getProducts"],setup(r){const a=f(r.pagination);return(b,e)=>(n(),i("nav",At,[t("ul",Et,[t("li",{class:w(["page-item",{disabled:!a.data.has_pre}])},[t("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:e[0]||(e[0]=s=>r.getProducts(a.data.current_page-1))},qt)],2),(n(!0),i(k,null,C(a.data.total_pages,(s,l)=>(n(),i("li",{key:l,class:w(["page-item",{active:s===a.data.current_page}])},[t("a",{class:"page-link",href:"#",onClick:p=>r.getProducts(s)},v(s),9,Gt)],2))),128)),t("li",{class:w(["page-item",{disabled:!a.data.has_next}])},[t("a",{class:"page-link",href:"#","aria-label":"Next",onClick:e[1]||(e[1]=s=>r.getProducts(a.data.current_page+1))},Jt)],2)])]))}},Ot={class:"container"},Qt={class:"text-end mt-4"},Wt={class:"table mt-4"},Xt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),Yt={class:"text-end"},Zt={class:"text-end"},ta={key:0,class:"text-success"},aa={key:1},ea={class:"btn-group"},sa=["onClick"],oa=["onClick"],la={class:"modal-dialog"},da={class:"modal-content border-0"},na=H('<div class="modal-header bg-danger text-white"><h5 id="delProductModalLabel" class="modal-title"><span>刪除產品</span></h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"> 是否刪除 <strong class="text-danger"></strong> 商品(刪除後將無法恢復)。 </div>',2),ia={class:"modal-footer"},ca=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),ra=["onClick"],ba={__name:"DashboardProducts",setup(r){const $=R(),a="vue-winter",b="https://vue3-course-api.hexschool.io/v2",e=q("axios"),s=f({data:[]}),l=f({data:{}}),p=g(!0),M=g(null),P=g(null),_=g(""),U=g(""),V=f({data:{}}),h=(o=1)=>{e.get(`${b}/api/${a}/admin/products?page=${o}`).then(c=>{s.data=c.data.products,V.data=c.data.pagination}).catch(c=>{alert("取得產品列表錯誤",c)})},L=()=>{e.post(`${b}/api/user/check`).then(()=>{h()}).catch(o=>{alert("token驗證錯誤",o),$.push({path:"/login"})})},N=async(o=l.data)=>{let c="";return await e.post(`${b}/api/${a}/admin/product`,{data:o}).then(d=>{c=d}).catch(d=>{alert("新增產品錯誤",d)}),c},S=async(o=l.data)=>{let c="";return await e.put(`${b}/api/${a}/admin/product/${l.data.id}`,{data:o}).then(d=>{c=d}).catch(d=>{alert("編輯產品錯誤",d)}),c},j=async()=>{await e.delete(`${b}/api/${a}/admin/product/${l.data.id}`).then(()=>{U.value.hide(),h()}).catch(o=>{alert("刪除產品錯誤",o)})},z=()=>{l.data.imagesUrl?(l.data.imagesUrl.push(""),p.value=!1):(l.data.imagesUrl=[],l.data.imagesUrl.push(""))},F=o=>{l.data.imagesUrl.length!==0?(l.data.imagesUrl.splice(o,1),p.value=!0):(l.data.imagesUrl=void 0,p.value=!0)},T=async()=>{if(l.data.status==="create")try{(await N()).status===200&&(_.value.hide(),h())}catch(o){alert("新增失敗",o)}else try{(await S()).status===200&&(_.value.hide(),h())}catch(o){console.log(o),alert("編輯失敗")}},x=(o,c={})=>{o==="create"?(l.data={},l.data.status=o,_.value.show()):o==="edit"?(l.data=c,l.data.status=o,_.value.show()):o==="del"&&(l.data=c,l.data.status=o,U.value.show())};return G(()=>{_.value=new B(M.value,{}),U.value=new B(P.value,{});const o=document.cookie.replace(/(?:(?:^|.*;\s*)hexschool\s*=\s*([^;]*).*$)|^.*$/,"$1");e.defaults.headers.common.Authorization=o,L()}),(o,c)=>(n(),i(k,null,[t("div",Ot,[t("div",Qt,[t("button",{class:"btn btn-primary",onClick:c[0]||(c[0]=d=>x("create"))},"建立新的產品")]),t("table",Wt,[Xt,t("tbody",null,[(n(!0),i(k,null,C(s.data,d=>(n(),i("tr",{key:d.id},[t("td",null,v(d.category),1),t("td",null,v(d.title),1),t("td",Yt,v(d.origin_price),1),t("td",Zt,v(d.price),1),t("td",null,[d.is_enabled?(n(),i("span",ta,"啟用")):(n(),i("span",aa,"未啟用"))]),t("td",null,[t("div",ea,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:A=>x("edit",d)}," 編輯 ",8,sa),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:A=>x("del",d)}," 刪除 ",8,oa)])])]))),128))])]),D(Kt,{pagination:V,"get-products":h},null,8,["pagination"])]),t("div",{id:"productModal",ref_key:"productModal",ref:M,class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},[D(Tt,{"temp-data":l,"add-img":z,"del-img":F,"submit-btn":T},null,8,["temp-data"])],512),t("div",{id:"delProductModal",ref_key:"delProductModal",ref:P,class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},[t("div",la,[t("div",da,[na,t("div",ia,[ca,t("button",{type:"button",class:"btn btn-danger",onClick:y(j,["prevent"])},"確認刪除",8,ra)])])])],512)],64))}};export{ba as default};
